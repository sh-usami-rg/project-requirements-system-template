# 中カテゴリ管理ガイド

## 概要

中カテゴリ管理機能は、プロジェクトのタスクを**3階層**で管理することで、より適切な粒度で進捗を把握できるようにする機能です。

### 3階層構造

```
プロジェクト
├── 大カテゴリ（Phase）: Phase 1, Phase 2, Phase 3
│   ├── 中カテゴリ（Mid Category）: 計画策定、要件定義、設計、実装、テストなど
│   │   └── 小カテゴリ（Task）: 個別のタスク（GitHub Issueとして管理）
```

### メリット

- **適切な粒度での管理**: Phase（大）とTask（小）の中間層を設けることで、プロジェクト全体を把握しやすくなります
- **GitHub上での可視化**: Projects V2のロードマップビューで中カテゴリごとにグループ化・フィルタリングが可能
- **進捗の追跡**: 中カテゴリ単位で進捗を確認し、ボトルネックを早期に発見できます
- **チーム間の調整**: 中カテゴリごとに担当チームを分けることで、並行作業がスムーズになります

---

## 中カテゴリの定義方法

### ステップ1: プロジェクトタイプの確認

プロジェクトの種類に応じて、適切な中カテゴリを定義します。

### ステップ2: 中カテゴリの選定

以下の例を参考に、プロジェクトに合った中カテゴリを選定してください。

---

## プロジェクトタイプ別の中カテゴリ例

### 1. Webアプリケーション開発プロジェクト

```
Phase 1: 企画・設計
  ├── 計画策定（2タスク）
  │   ├── プロジェクト憲章作成
  │   └── キックオフミーティング開催
  └── 要件定義（3タスク）
      ├── ユーザーヒアリング実施
      ├── 要件定義書作成
      └── 要件レビュー実施

Phase 2: 開発
  ├── 設計（5タスク）
  │   ├── システム設計書作成
  │   ├── DB設計
  │   └── API設計
  ├── 環境構築（4タスク）
  │   ├── 開発環境セットアップ
  │   ├── CI/CDパイプライン構築
  │   └── 本番環境準備
  ├── フロントエンド実装（8タスク）
  │   ├── UIコンポーネント実装
  │   ├── 画面実装
  │   └── 状態管理実装
  └── バックエンド実装（10タスク）
      ├── API実装
      ├── ビジネスロジック実装
      └── データベース実装

Phase 3: テスト・リリース
  ├── テスト（6タスク）
  │   ├── 単体テスト
  │   ├── 結合テスト
  │   └── E2Eテスト
  └── デプロイ・リリース（4タスク）
      ├── ステージング環境デプロイ
      ├── 本番環境デプロイ
      └── リリース告知
```

**中カテゴリ一覧**:
- 計画策定
- 要件定義
- 設計
- 環境構築
- フロントエンド実装
- バックエンド実装
- テスト
- デプロイ・リリース

### 2. データ分析プロジェクト

```
Phase 1: 調査・設計
  ├── 調査・分析（3タスク）
  │   ├── 既存データ調査
  │   ├── データ品質分析
  │   └── 分析要件定義
  └── データモデル設計（4タスク）
      ├── データソース定義
      ├── データマッピング設計
      └── KPI定義

Phase 2: 環境構築・学習
  ├── 環境構築（3タスク）
  │   ├── BigQuery環境セットアップ
  │   ├── Looker環境セットアップ
  │   └── Git連携設定
  ├── 学習（2タスク）
  │   ├── LookerMLトレーニング
  │   └── ハンズオン実施
  └── PoC（5タスク）
      ├── サンプルダッシュボード作成
      ├── データ整合性検証
      └── パフォーマンステスト

Phase 3: 実装・検証
  ├── BigQuery実装（6タスク）
  │   ├── データパイプライン構築
  │   ├── データ変換処理実装
  │   └── スケジュール設定
  ├── LookerML実装（8タスク）
  │   ├── View作成
  │   ├── Explore作成
  │   └── ダッシュボード構築
  ├── 精度検証（4タスク）
  │   ├── データ整合性チェック
  │   ├── パフォーマンステスト
  │   └── セキュリティチェック
  ├── ユーザーテスト（3タスク）
  │   ├── ユーザーレビュー実施
  │   ├── フィードバック対応
  │   └── 最終確認
  └── 本番リリース（3タスク）
      ├── 本番環境デプロイ
      ├── 監視設定
      └── ドキュメント作成
```

**中カテゴリ一覧**:
- 調査・分析
- データモデル設計
- 環境構築
- 学習
- PoC
- BigQuery実装
- LookerML実装
- 精度検証
- ユーザーテスト
- 本番リリース

### 3. インフラ構築プロジェクト

```
Phase 1: 企画・設計
  ├── 計画策定（2タスク）
  ├── 要件定義（3タスク）
  └── 設計（5タスク）

Phase 2: 構築
  ├── 環境構築（4タスク）
  ├── ネットワーク設定（6タスク）
  ├── セキュリティ設定（5タスク）
  └── 監視設定（4タスク）

Phase 3: テスト・移行
  ├── テスト（5タスク）
  └── 本番移行（3タスク）
```

**中カテゴリ一覧**:
- 計画策定
- 要件定義
- 設計
- 環境構築
- ネットワーク設定
- セキュリティ設定
- 監視設定
- テスト
- 本番移行

### 4. マイグレーションプロジェクト

```
Phase 1: 分析・設計
  ├── 現状分析（3タスク）
  ├── ギャップ分析（2タスク）
  └── 移行設計（4タスク）

Phase 2: 移行準備
  ├── 環境構築（3タスク）
  ├── データ移行準備（5タスク）
  └── テスト環境構築（2タスク）

Phase 3: 移行実施
  ├── 段階的移行（6タスク）
  ├── データ検証（4タスク）
  ├── 並行運用（3タスク）
  └── 本番切替（3タスク）
```

**中カテゴリ一覧**:
- 現状分析
- ギャップ分析
- 移行設計
- 環境構築
- データ移行準備
- テスト環境構築
- 段階的移行
- データ検証
- 並行運用
- 本番切替

---

## tasks.jsonへの追加方法

### 手動で追加する場合

各タスクに `midCategory` フィールドを追加します：

```json
{
  "tasks": [
    {
      "id": "TASK-001",
      "title": "プロジェクト計画策定",
      "phase": "Phase 1",
      "midCategory": "計画策定",
      "category": "documentation",
      "priority": "high",
      ...
    },
    {
      "id": "TASK-002",
      "title": "要件定義書作成",
      "phase": "Phase 1",
      "midCategory": "要件定義",
      "category": "documentation",
      "priority": "high",
      ...
    }
  ]
}
```

### スクリプトで一括追加する場合

`scripts/add-mid-category.py` を使用して一括追加できます：

```bash
# スクリプトを実行
python3 scripts/add-mid-category.py

# 中カテゴリの件数を確認
✓ TASK-001: 計画策定
✓ TASK-002: 要件定義
✓ TASK-003: 設計
...

✅ 中カテゴリを25タスクに追加しました

中カテゴリ別件数:
  - 計画策定: 2タスク
  - 要件定義: 3タスク
  - 設計: 5タスク
  ...
```

**注意**: スクリプト内の `MID_CATEGORY_MAPPING` を編集して、各タスクIDに対応する中カテゴリを定義してください。

---

## GitHubへの同期方法

### ステップ1: 中カテゴリラベルの作成とIssueタイトル変更

```bash
python3 scripts/update-mid-category-to-github.py
```

このスクリプトは以下を実行します：

1. **ラベル作成**: `mid:計画策定`, `mid:要件定義` などのラベルを作成
2. **Issueタイトル変更**: `TASK-001: タスク名` → `計画策定：タスク名` に変更
3. **ラベル付与**: 各Issueに対応する中カテゴリラベルを付与

**実行例**:

```
🏷️  中カテゴリラベルを作成中...
✓ ラベル 'mid:計画策定' を作成しました（色: #10B981）
✓ ラベル 'mid:要件定義' を作成しました（色: #3B82F6）
✓ ラベル 'mid:設計' を作成しました（色: #8B5CF6）
...

📝 Issueタイトルと中カテゴリラベルを更新中...
✓ Issue #1: 計画策定：プロジェクト計画策定
✓ Issue #2: 要件定義：要件定義書作成
✓ Issue #3: 設計：システム設計書作成
...

✅ 25個のIssueを更新しました
```

### ステップ2: Projects V2に「Mid Category」フィールド追加

```bash
python3 scripts/add-mid-category-field-to-projects.py
```

このスクリプトは以下を実行します：

1. **フィールド作成**: Projects V2に「Mid Category」Single Selectフィールドを作成
2. **オプション設定**: 中カテゴリのオプションを設定（計画策定、要件定義、設計など）
3. **フィールド値設定**: 各Issueにフィールド値を設定

**実行例**:

```
🔍 GitHub Projects V2を検索中...
✓ プロジェクト '顧問ミドル運用ダッシュボード移行' を見つけました（ID: PVT_xxx）

📋 'Mid Category' フィールドを作成中...
✓ フィールドを作成しました（ID: PVTF_xxx）

オプション一覧:
  - 計画策定（GREEN）
  - 要件定義（BLUE）
  - 設計（PURPLE）
  - 環境構築（YELLOW）
  - 実装（ORANGE）
  - テスト（RED）
  - デプロイ・リリース（PINK）
  ...

🔗 各Issueにフィールド値を設定中...
✓ Issue #1: 計画策定
✓ Issue #2: 要件定義
✓ Issue #3: 設計
...

✅ 25個のIssueにフィールド値を設定しました
```

---

## GitHub上での可視化

### 1. ロードマップビューでグループ化

GitHub Projects V2のロードマップビューで、中カテゴリごとにグループ化できます：

1. Projects V2を開く
2. ビューを「Roadmap」に変更
3. 「Group by」で「Mid Category」を選択

これにより、中カテゴリごとにタスクがグループ化され、視覚的に進捗を確認できます。

### 2. フィルタリング

特定の中カテゴリのタスクだけを表示できます：

1. Projects V2を開く
2. フィルタアイコンをクリック
3. 「Mid Category」を選択し、表示したい中カテゴリを選択

例: 「実装」の中カテゴリだけを表示

### 3. ラベルでの検索

GitHubのIssue検索で中カテゴリラベルを使用できます：

```
label:"mid:実装"
```

---

## ベストプラクティス

### 1. 中カテゴリの数

- **推奨**: 5-10個の中カテゴリ
- **理由**: 多すぎると管理が複雑になり、少なすぎると粒度が粗くなります

### 2. 命名規則

- **動詞形 + 名詞**: 「実装」「設計」「テスト」など、作業内容を表す名前にする
- **一貫性**: プロジェクト全体で命名規則を統一する

### 3. Phase vs Mid Category

- **Phase（大カテゴリ）**: プロジェクトの大きな段階（企画、開発、リリースなど）
- **Mid Category（中カテゴリ）**: 作業の種類（設計、実装、テストなど）

例:
- Phase 1に「設計」という中カテゴリがある
- Phase 2にも「設計」という中カテゴリがある
- これは問題ありません（フェーズごとに同じ中カテゴリが存在してOK）

### 4. GitHub Issueタイトル

中カテゴリをIssueタイトルに含めることで、Issue一覧で分かりやすくなります：

- ❌ `TASK-001: プロジェクト計画策定`
- ✅ `計画策定：プロジェクト計画策定`

### 5. 依存関係の管理

中カテゴリ単位で依存関係を考えることで、並行作業を最大化できます：

- 「要件定義」が完了してから「設計」を開始
- 「設計」が完了してから「実装」を開始
- 「フロントエンド実装」と「バックエンド実装」は並行して進める

---

## よくある質問（FAQ）

### Q1: 既存のプロジェクトに中カテゴリを追加できますか？

**A**: はい、既存の `tasks.json` に `midCategory` フィールドを追加するだけです。`scripts/add-mid-category.py` を使用すれば一括追加できます。

### Q2: 中カテゴリは必須ですか？

**A**: いいえ、オプション機能です。中カテゴリを使用しないプロジェクトでも問題ありません。

### Q3: 中カテゴリを後から変更できますか？

**A**: はい、`tasks.json` の `midCategory` フィールドを編集し、再度 `update-mid-category-to-github.py` を実行することで変更できます。

### Q4: 同じPhaseに同じ中カテゴリが複数あってもいいですか？

**A**: はい、問題ありません。例えば、Phase 1とPhase 2の両方に「設計」という中カテゴリがあっても大丈夫です。

### Q5: 中カテゴリ別の進捗率を確認できますか？

**A**: GitHub Projects V2のロードマップビューで、中カテゴリごとにグループ化することで、視覚的に進捗を確認できます。また、`tasks.json` を分析するスクリプトを作成することで、中カテゴリ別の進捗率を計算できます。

---

## トラブルシューティング

### エラー: ラベルが作成できない

**原因**: GitHub CLI (gh) が認証されていない、またはリポジトリの権限が不足している

**解決策**:
```bash
# GitHub CLI認証
gh auth login

# 権限を確認（repo権限が必要）
gh auth status
```

### エラー: Projects V2フィールドが作成できない

**原因**: GraphQL APIの権限不足、またはプロジェクトIDが間違っている

**解決策**:
1. プロジェクトIDを確認
2. GitHub Personal Access Tokenに `project` スコープがあることを確認

### Issueタイトルが変更されない

**原因**: `tasks.json` に `midCategory` フィールドが追加されていない

**解決策**:
```bash
# tasks.jsonを確認
cat tasks.json | jq '.tasks[0].midCategory'

# nullの場合は、add-mid-category.pyを実行
python3 scripts/add-mid-category.py
```

---

## まとめ

中カテゴリ管理機能を使用することで：

- ✅ プロジェクトを**3階層**で管理し、適切な粒度で進捗を把握
- ✅ GitHub Projects V2で**視覚的に管理**
- ✅ 中カテゴリ単位で**フィルタリング・グループ化**
- ✅ チーム間の**並行作業を最大化**

プロジェクトに合った中カテゴリを定義し、効率的なプロジェクト管理を実現しましょう。
